<script type="text/x-red" data-template-name="klicktipp-subscriber-index">
	<div class="form-row">
			<label for="node-input-name"><i class="fa fa-tag"></i> <span>Name</span></label>
			<input type="text" id="node-input-name" placeholder="Enter node name">
	</div>
	<div class="form-row">
	    <label for="node-input-klicktipp"><i class="fa fa-cog"></i> <span>KlickTipp Config</span></label>
	    <input type="text" id="node-input-klicktipp" data-i18n="config node">
	</div>
	<div class="form-row">
		<label for="node-input-subscriptionStatus">
			<i class="fa fa-filter"></i>
			<span>Subscription Status</span>
			<i
				class="fa fa-info-circle"
				style="margin-left:4px; color:#888; cursor: help;"
				title="Filter contacts by their subscription status. You can select one or multiple values to narrow down the results. If no value is selected, the filter defaults to Subscribed, meaning only contacts with an active subscription are included."
			></i>
		</label>
		<select id="node-input-subscriptionStatus" multiple style="width: 70%;">
			<option value="pending">Pending</option>
			<option value="subscribed">Subscribed</option>
			<option value="unsubscribed">Unsubscribed</option>
		</select>
	</div>
	<div class="form-row">
		<label for="node-input-bounceStatus">
			<i class="fa fa-filter"></i>
			<span>Bounce Status</span>
			<i
				class="fa fa-info-circle"
				style="margin-left:4px; color:#888; cursor: help;"
				title="Filter contacts by their bounce status. You can select one or multiple values. If no value is selected, the filter defaults to Soft Bounce, Spam Bounce, and No Bounce."
			></i>
		</label>
		<select id="node-input-bounceStatus" multiple style="width: 70%;">
			<option value="hardbounce">Hard bounce</option>
			<option value="softbounce">Soft bounce</option>
			<option value="spambounce">Spam bounce</option>
			<option value="nobounce">No bounce</option>
		</select>
	</div>
</script>

<script type="text/x-red" data-help-name="klicktipp-subscriber-index">
	<p>Lists the IDs of all active contacts</p>

	<h3>Inputs</h3>
	<dl class="message-properties">
		<dt>Node Configuration <span class="property-type">object</span></dt>
		<dd>
			Optional filters configured in the node:
			<ul>
				<li>
					<strong>Subscription Status</strong> - (Optional) One or more values selected in the node settings.
					Multiple values are combined using a comma (e.g. <code>unsubscribed,pending</code>).
				</li>
				<li>
					<strong>Bounce Status</strong> - (Optional) One or more values selected in the node settings.
					Multiple values are combined using a comma (e.g. <code>hardbounce,nobounce</code>).
				</li>
			</ul>
		</dd>
	</dl>

	<h3>Outputs</h3>
	<dl class="message-properties">
	   <dt>msg.payload <span class="property-type">object</span></dt>
	   <dd>
		   On success:
		   <ul>
			   <li>An array containing the contact IDs of all active contacts.</li>
		   </ul>
	   </dd>
	   <dd>
		   On failure:
		   <ul>
			   <li><code>{ success: false }</code></li>
		   </ul>
	   </dd>

	   <dt>msg.error <span class="property-type">string</span></dt>
	   <dd>An error message indicating why the request failed.</dd>
	</dl>

	<h3>Node Status</h3>
	<ul>
	    <li><strong>Green (dot)</strong> - Successfully fetched the contact list.</li>
	    <li><strong>Red (ring)</strong> - Failed to fetch contacts (e.g., API error).</li>
	</ul>
</script>

<script type="text/javascript">
	RED.nodes.registerType('klicktipp-subscriber-index', {
		category: 'KlickTipp',
		color: '#DAE1FC',
		defaults: {
			klicktipp: { type: 'klicktipp-config', required: true },
			name: { value: '' },
			subscriptionStatus: { value: [] },
			bounceStatus: { value: [] },
		},
		inputs: 1,
		outputs: 1,
		icon: 'klicktipp.svg',
		label: function () {
			return this.name || 'List Contacts';
		},
		labelStyle: 'klicktipp_label_style',
		paletteLabel: 'List Contacts',
		onadd: function () {
			ktPopulateConfig(this);
		},
		oneditprepare: function () {
			const node = this;

			$('#node-input-subscriptionStatus').val(node.subscriptionStatus || []);
			$('#node-input-bounceStatus').val(node.bounceStatus || []);
		},
	});
</script>